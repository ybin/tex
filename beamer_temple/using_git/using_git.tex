\documentclass{beamer}

\input{beamer_template}
\input{tikz_template}

%********** title page settings **********
\title{Using GIT}
\author{孙延宾}
\institute{业务软件开发一部$\cdot$西安}
\date{\today}

\begin{document}

%*************** title page *****************
\begin{frame}[plain]
  \titlepage
\end{frame}
%*************** title page *****************

%%%%%%%%%%%%%%%%%%%%% Introduce %%%%%%%%%%%%%%%%%%%%%%%%%%
\part[Introduce]{Introduce}
\section[What is git]{What is git}
\begin{frame}
\begin{framedtext}
  What is git~?\\[1em]
  Git是一个分布式版本控制软件，原来是linux内核开发者林纳斯$\cdot$托瓦兹(Linus Torvalds)为了更好地管理linux内核开发而创立的。
\end{framedtext}
\end{frame}

\begin{frame}{copy working directory as a version}
\begin{center}
  \begin{tikzpicture}%[main-style]
    %%% directory - 1
    \node[file-style] (a1) {\tiny a.h};
    \node[file-style,right=0.2cm of a1] (b1) {\tiny b.h};
    \node[file-style,right=0.2cm of b1] (c1) {\tiny c.h};
    \node[file-style,below=0.1cm of b1] (d1) {\tiny\textcolor{blue}{$d_{v1}.h$}};
    \node[dir-style,below=0.2cm of d1] (dir1) {\tiny directory-1};
    \begin{pgfonlayer}{background}
      \node [dir-bg-style,fit=(a1) (b1) (c1) (d1) (dir1)] {};
    \end{pgfonlayer}

    %%% directory - 2
    \node[file-style,right=1.5cm of c1] (a2) {\tiny a.h};
    \node[file-style,right=0.2cm of a2] (b2) {\tiny b.h};
    \node[file-style,right=0.2cm of b2] (c2) {\tiny c.h};
    \node[file-style,below=0.1cm of b2] (d2) {\tiny\textcolor{blue}{$d_{v2}.h$}};
    \node[dir-style,below=0.2cm of d2] (dir2) {\tiny directory-2};
    \begin{pgfonlayer}{background}
      \node [dir-bg-style,fit=(a2) (b2) (c2) (d2) (dir2)] {};
    \end{pgfonlayer}

    %%% directory - 3
    \node[file-style,right=1.5cm of c2] (a3) {\tiny a.h};
    \node[file-style,right=0.2cm of a3] (b3) {\tiny b.h};
    \node[file-style,right=0.2cm of b3] (c3) {\tiny c.h};
    \node[file-style,below=0.1cm of b3] (d3) {\tiny\textcolor{blue}{$d_{v3}.h$}};
    \node[dir-style,below=0.2cm of d3] (dir3) {\tiny directory-3};
    \begin{pgfonlayer}{background}
      \node [dir-bg-style,fit=(a3) (b3) (c3) (d3) (dir3)] {};
    \end{pgfonlayer}

    %%% working directory
    \node[file-style,below=2cm of dir2] (b4) {\tiny b.h};
    \node[file-style,left=0.2cm of b4] (a4) {\tiny a.h};
    \node[file-style,right=0.2cm of b4] (c4) {\tiny c.h};
    \node[file-style,below=0.1cm of b4] (d4) {\tiny $d_{v3}.h$};
    \node[dir-style,below=0.2cm of d4] (dir4) {\tiny working dir};
    \begin{pgfonlayer}{background}
      \node [dir-bg-style,fit=(a4) (b4) (c4) (d4) (dir4)] {};
    \end{pgfonlayer}

    %%% arrows
    % dir-1 to dir2
    \path[->] ([xshift=1cm]d1.east) edge ([xshift=-1cm]d2.west);
    % dir-2 to dir3
    \path[->] ([xshift=1cm]d2.east) edge ([xshift=-1cm]d3.west);
    % working dir to dir1
    \path[->] ([yshift=0.2cm]a4.north west) edge node[right]{\tiny copy as v1} ([yshift=-0.2cm]dir1.south);
    % working dir to dir2
    \path[->] ([yshift=0.2cm]b4.north) edge node[right]{\tiny copy as v2} ([yshift=-0.2cm]dir2.south);
    % working dir to dir3
    \path[->] ([yshift=0.2cm]c4.north east) edge node[right]{\tiny copy as v3} ([yshift=-0.2cm]dir3.south);
  \end{tikzpicture}
\end{center}
\end{frame}

\begin{frame}{put all files in a repository directory}
\begin{center}
  \begin{tikzpicture}
    %%% file lists
    \createMatrix{1}{(0,0)}
    \createMatrix{2}{([xshift=3cm]m1)}
    \createMatrix{3}{([xshift=3cm]m2)}

    %%% repository
    \node[file-style,above=2.5cm of m2] (bRepo) {\tiny b.h};
    \node[file-style,left=0.2cm of bRepo] (aRepo) {\tiny a.h};
    \node[file-style,right=0.2cm of bRepo] (cRepo) {\tiny c.h};
    \node[file-style,below=0.1cm of bRepo] (dRepoV1) {\tiny $d_{v1}.h$};
    \node[file-style,below=0.1cm of dRepoV1] (dRepoV2) {\tiny $d_{v2}.h$};
    \node[file-style,below=0.1cm of dRepoV2] (dRepoV3) {\tiny $d_{v3}.h$};
    \node[dir-style,below=0.2cm of dRepoV3] (dirRepo) {\tiny repository dir};
    \begin{pgfonlayer}{background}
      \node [dir-bg-style,fit=(aRepo) (bRepo) (cRepo) (dRepoV1) (dRepoV2) (dRepoV3) (dirRepo)] {};
    \end{pgfonlayer}

    %%% working directory
    \node[file-style,below=1cm of m2] (bWork) {\tiny b.h};
    \node[file-style,left=0.2cm of bWork] (aWork) {\tiny a.h};
    \node[file-style,right=0.2cm of bWork] (cWork) {\tiny c.h};
    \node[file-style,below=0.1cm of bWork] (dWork) {\tiny $d_{v3}.h$};
    \node[dir-style,below=0.2cm of dWork] (dirWork) {\tiny working dir};
    \begin{pgfonlayer}{background}
      \node [dir-bg-style,fit=(aWork) (bWork) (cWork) (dWork) (dirWork)] {};
    \end{pgfonlayer}

    %%% arrows
    \path[->] (m1.east) edge (m2.west);
    \path[->] (m2.east) edge (m3.west);
  \end{tikzpicture}
\end{center}
\end{frame}

\begin{frame}{map file content to SHA-1 string}
\begin{center}
  \begin{tikzpicture}
    %%% file lists
    \createHashMatrix{1}{(0,0)}
    \createHashMatrix{2}{([xshift=3cm]m1)}
    \createHashMatrix{3}{([xshift=3cm]m2)}

    %%% repository
    \node[file-style,above=2.5cm of m2] (bRepo) {\tiny b325c};
    \node[file-style,left=0.2cm of bRepo] (aRepo) {\tiny a47c3};
    \node[file-style,right=0.2cm of bRepo] (cRepo) {\tiny c10b9};
    \node[file-style,below=0.1cm of bRepo] (dRepoV1) {\tiny da981};
    \node[file-style,below=0.1cm of dRepoV1] (dRepoV2) {\tiny da982};
    \node[file-style,below=0.1cm of dRepoV2] (dRepoV3) {\tiny da983};
    \node[dir-style,below=0.2cm of dRepoV3] (dirRepo) {\tiny repository dir};
    \begin{pgfonlayer}{background}
      \node [dir-bg-style,fit=(aRepo) (bRepo) (cRepo) (dRepoV1) (dRepoV2) (dRepoV3) (dirRepo)] {};
    \end{pgfonlayer}

    %%% working directory
    \node[file-style,below=1cm of m2] (bWork) {\tiny b.h};
    \node[file-style,left=0.2cm of bWork] (aWork) {\tiny a.h};
    \node[file-style,right=0.2cm of bWork] (cWork) {\tiny c.h};
    \node[file-style,below=0.1cm of bWork] (dWork) {\tiny d.h};
    \node[dir-style,below=0.2cm of dWork] (dirWork) {\tiny working dir};
    \begin{pgfonlayer}{background}
      \node [dir-bg-style,fit=(aWork) (bWork) (cWork) (dWork) (dirWork)] {};
    \end{pgfonlayer}

    %%% arrows
    \path[->] (m1.east) edge (m2.west);
    \path[->] (m2.east) edge (m3.west);
  \end{tikzpicture}
\end{center}
\end{frame}

\begin{frame}{add an index file}
\begin{center}
  \begin{tikzpicture}
    %%% file lists
    \createHashMatrix{1}{(0,0)}
    \createHashMatrix{2}{([xshift=3cm]m1)}
    \createHashMatrix{3}{([xshift=3cm]m2)}

    %%% repository
    \node[file-style,above=2cm of m2] (bRepo) {\tiny b325c};
    \node[file-style,left=0.2cm of bRepo] (aRepo) {\tiny a47c3};
    \node[file-style,right=0.2cm of bRepo] (cRepo) {\tiny c10b9};
    \node[file-style,below=0.1cm of bRepo] (dRepoV1) {\tiny da981};
    \node[file-style,below=0.1cm of dRepoV1] (dRepoV2) {\tiny da982};
    \node[file-style,below=0.1cm of dRepoV2] (dRepoV3) {\tiny da983};
    \node[dir-style,below=0.2cm of dRepoV3] (dirRepo) {\tiny repository dir};
    \begin{pgfonlayer}{background}
      \node [dir-bg-style,fit=(aRepo) (bRepo) (cRepo) (dRepoV1) (dRepoV2) (dRepoV3) (dirRepo)] {};
    \end{pgfonlayer}

    \matrix [
      matrix of nodes,
      nodes={rectangle,draw=red,fill=yellow!30,minimum width=1.3cm,font=\ttfamily\tiny,inner sep=2pt},
      row sep=-\pgflinewidth,
      column sep=-\pgflinewidth,
      below=-0.1cm of m2
    ] (index){
      \textcolor{blue}{index}\\
      a47c3: a.h\\
      b325c: b.h\\
      c10b9: c.h\\
      da983: d.h\\
    };

    %%% working directory
    \node[file-style,below=0.1cm of index] (bWork) {\tiny b.h};
    \node[file-style,left=0.2cm of bWork] (aWork) {\tiny a.h};
    \node[file-style,right=0.2cm of bWork] (cWork) {\tiny c.h};
    \node[file-style,below=0.1cm of bWork] (dWork) {\tiny d.h};
    \node[dir-style,below=0.1cm of dWork] (dirWork) {\tiny working dir};
    \begin{pgfonlayer}{background}
      \node [dir-bg-style,fit=(aWork) (bWork) (cWork) (dWork) (dirWork)] {};
    \end{pgfonlayer}

    %%% arrows
    \path[->] (m1.east) edge (m2.west);
    \path[->] (m2.east) edge (m3.west);
    \path[->,dashed] (cWork.east) edge[bend right=45] (index-4-1.east);
    \path[->,dashed] ([yshift=0.05cm]index-4-1.east) edge[out=0,in=180] (m3-4-1);
    \path[->,dashed] (m3-4-1.east) edge[out=30,in=-10] (cRepo.east);
  \end{tikzpicture}
\end{center}
\end{frame}

%%%%%%%%%%%%%%%%%%%%% Local Operation %%%%%%%%%%%%%%%%%%%%%%%%
\part[Local Operations]{Local Operations}
\section[git add]{git add}
\begin{frame}{\ {}}
  \gitcmd{git add}
\end{frame}

\begin{frame}{git add}
\begin{center}
  \begin{tikzpicture}[main-style]
    \makeOutline
    \createBranch name:release display:{\displayName release} direct:above to:b;
    \createBranch name:master display:{\displayName master} direct:above to:e;
    \createHead direct:above to:master;

    \createIndex to:c;
    \createWork to:index;

    \path (work) edge[bend right=30] node[cmd-style=left]{\commandName git add files/directories} (index);
  \end{tikzpicture}
\end{center}
\end{frame}

\section[git commit]{git commit}
\begin{frame}{\ {}}
  \gitcmd{git commit}
\end{frame}

\begin{frame}{git commit}
\begin{center}
  \begin{tikzpicture}[main-style]
    \makeOutline
    \createBranch name:release display:{\displayName release} direct:above to:b;
    \createBranch name:master display:{\displayName master} direct:above to:e;
    \createHead direct:above to:master;

    \createIndex to:c;
    \createWork to:index;

    \path (index) edge[out=60,in=245] node[cmd-style=below,near end]{\commandName git commit} (e);
  \end{tikzpicture}
\end{center}
\end{frame}

\section[git checkout]{git checkout}
\begin{frame}{\ {}}
  \gitcmd{git checkout}
\end{frame}
\begin{frame}{git checkout}
\begin{center}
  \begin{tikzpicture}[main-style]
    \makeOutline
    \createBranch name:release display:{\displayName release} direct:above to:b;
    \createBranch name:master display:{\displayName master} direct:above to:e;
    \createHead direct:above to:master;

    \createIndex to:c;
    \createWork to:index;

    \path (index) edge[bend right=30] node[cmd-style=left]{\commandName git checkout -- files} (work);
    \path (e.south) edge[bend left=45] node[circle,fill=red,swap,auto,inner sep=1pt] {\tiny{1}}
      node[cmd-style=left,swap,pos=0.15]{\commandName git checkout E} (index.east);
    \path (e.south) edge[bend left=45]
      node[circle,fill=red,auto,swap,inner sep=1pt] {\tiny{2}} (work.east);
  \end{tikzpicture}
\end{center}
\end{frame}

\section[git reset]{git reset}
\begin{frame}{\ {}}
  \gitcmd{git reset}
\end{frame}

\subsection[git reset \texttt{-{}-} files]{git reset \texttt{-{}-} files}
\begin{frame}{\ {}}
  \gitcmd{git reset \texttt{-{}-} files}
\end{frame}

\begin{frame}{git reset \texttt{-{}-} files}
\begin{center}
  \begin{tikzpicture}[main-style]
    \makeOutline
    \createBranch name:release display:{\displayName release} direct:above to:b;
    \createBranch name:master display:{\displayName master} direct:above to:e;
    \createHead direct:above to:master;

    \createIndex to:c;
    \createWork to:index;

    \path (e.south) edge[out=270,in=0] node[cmd-style=above,auto,swap]{\commandName git reset -- files} (index.east);
  \end{tikzpicture}
\end{center}
\end{frame}

\subsection[git reset \texttt{-{}-}soft commit]{git reset \texttt{-{}-}soft commit}
\begin{frame}{\ {}}
  \gitcmd{git reset \texttt{-{}-}soft commit}
\end{frame}

\begin{frame}{git reset \texttt{-{}-}soft commit}
\begin{center}
  \begin{tikzpicture}[main-style]
    \makeOutline
    \createBranch name:release display:{\displayName release} direct:above to:b;

    % create old master branch & HEAD
    \path <1> node [branch-style, above=0.75\commitDistance of e] (master) {master}
        edge [cmd-style, BRANCHCOLOR] (e);
    % create new master branch & HEAD
    \path <2> node [branch-style, above=0.75\commitDistance of d] (master) {master}
        edge [cmd-style, BRANCHCOLOR] (d);
    \path <2-> (e.north west) edge[bend right=30,<->] (d.north east);
    \createHead direct:above to:master;

    \createIndex to:c;
    \createWork to:index;
  \end{tikzpicture}
\end{center}
\end{frame}

\subsection[git reset \texttt{-{}-}mixed commit]{git reset \texttt{-{}-}mixed commit}
\begin{frame}{\ {}}
  \gitcmd{git reset \texttt{-{}-}mixed commit}
\end{frame}

\begin{frame}{git reset \texttt{-{}-}mixed commit}
\begin{center}
  \begin{tikzpicture}[main-style]
    \makeOutline
    \createBranch name:release display:{\displayName release} direct:above to:b;

    % create old master branch & HEAD
    \path <1> node [branch-style, above=0.75\commitDistance of e] (master) {master}
        edge [cmd-style, BRANCHCOLOR] (e);
    % create new master branch & HEAD
    \path <2-> node [branch-style, above=0.75\commitDistance of d] (master) {master}
        edge [cmd-style, BRANCHCOLOR] (d);
    \path <2-> (e.north west) edge[bend right=30,<->] node[circle,above,auto,swap,fill=red,inner sep=1pt]{\tiny{1}}
                (d.north east);
    \createHead direct:above to:master;

    \createIndex to:c;
    \createWork to:index;

    \path <3-> (e.south) edge[bend left=45] node[circle,fill=red,swap,auto,inner sep=1pt] {\tiny{2}}(index.east);
  \end{tikzpicture}
\end{center}
\end{frame}

\subsection[git reset \texttt{-{}-}hard commit]{git reset \texttt{-{}-}hard commit}
\begin{frame}{\ {}}
  \gitcmd{git reset \texttt{-{}-}hard commit}
\end{frame}

\begin{frame}{git reset \texttt{-{}-}hard commit}
\begin{center}
  \begin{tikzpicture}[main-style]
    \makeOutline
    \createBranch name:release display:{\displayName release} direct:above to:b;

    % create old master branch & HEAD
    \path <1> node [branch-style, above=0.75\commitDistance of e] (master) {master}
        edge [cmd-style, BRANCHCOLOR] (e);
    % create new master branch & HEAD
    \path <2-> node [branch-style, above=0.75\commitDistance of d] (master) {master}
        edge [cmd-style, BRANCHCOLOR] (d);
    \path <2-> (e.north west) edge[bend right=30,<->] node[circle,above,auto,swap,fill=red,inner sep=1pt]{\tiny{1}}
                (d.north east);
    \createHead direct:above to:master;

    \createIndex to:c;
    \createWork to:index;

    \path <3-> (e.south) edge[bend left=45] node[circle,fill=red,swap,auto,inner sep=1pt] {\tiny{2}}(index.east);
    \path <4-> (e.south) edge[bend left=45]
      node[circle,fill=red,auto,swap,inner sep=1pt] {\tiny{3}} (work.east);
  \end{tikzpicture}
\end{center}
\end{frame}

\section[git diff]{git diff}
\begin{frame}{\ {}}
  \gitcmd{git diff}
\end{frame}

\begin{frame}{git diff}
\begin{center}
  \begin{tikzpicture}[main-style]
    \makeOutline
    \createBranch name:release display:{\displayName release} direct:above to:a;
    \createBranch name:master display:{\displayName master} direct:above to:e;
    \createHead direct:above to:master;

    \createIndex to:c;
    \createWork to:index;

    \path <1-> (work.north west) edge[bend left=45,<->] node[left]{\displayName git diff file} (index.south west);
    \path <2-> (index.east) edge[bend right=45,<->] node[above,auto,near end]{\displayName git diff --cached file} (e.south);
    \path <3-> (work.east) edge[bend right=45,<->] node[above,auto,pos=0.4]{\displayName git diff E file} (e.-70);
    \path <4-> (b.north east) edge[bend left=30,<->] node[above,auto]{\displayName git diff B..D file} (d.north west);
  \end{tikzpicture}
\end{center}
\end{frame}


%%% branch operations
\section[git merge]{git merge}
\begin{frame}{\ {}}
  \gitcmd{git merge}
\end{frame}

\begin{frame}{git merge}
\begin{center}
  \begin{tikzpicture}

  \end{tikzpicture}
\end{center}
\end{frame}

\section[git rebase]{git rebase}
\begin{frame}{\ {}}
  \gitcmd{git rebase}
\end{frame}

\begin{frame}{git rebase}
\begin{center}
  \begin{tikzpicture}

  \end{tikzpicture}
\end{center}
\end{frame}


%%%%%%%%%%%%%%%%%% Remote Operations %%%%%%%%%%%%%%%%%%%%%%
\part[Remote Operations]{Remote Operations}
\section[git fetch]{git fetch}
\begin{frame}{git fetch}
\end{frame}

\section[git pull]{git pull}
\begin{frame}{}
\end{frame}

\section[git push]{git push}
\begin{frame}{}
\end{frame}


%%%%%%%%%%%%%%%%%% Tips and Tricks %%%%%%%%%%%%%%%%%%%%%%%%
\part[Tips and Tricks]{Tips and Tricks}
\section[fetch a single branch]{fetch a single branch}
\begin{frame}{fetch a single branch}

\gitcmd{\small\ttfamily
  \begin{tabular}{rl}
    git clone & --single-branch\\
              & --branch\surrounded{rbranch} \ --depth 1\\
              & \surrounded{repo-url} \optionalSurrounded{directory}
  \end{tabular}
}
{\ttfamily
  \begin{tabular}{rcl}
    --single-branch&:&只复制一个分支\\
    --branch\surrounded{rbranch}&:&分支名称，并将HEAD指向该分支\\
    --depth 1&:&只复制最新的1个commit\\
  \end{tabular}
}
\end{frame}

\section[apply a patch]{apply a patch}
\begin{frame}{create patch files 1}
  \gitcmd{git diff > filename.[patch|diff]}
{\ttfamily
  该方法使用“标准”的diff格式创建patch文件，
  该patch文件在Git, SVN, BitKeeper等工具上都可以使用。
}
\end{frame}
\begin{frame}{create patch files 2}
  \gitcmd{git format-patch \surrounded{commit-id}}
{\ttfamily
  从\surrounded{commit-id}(不包括该commit)到HEAD之间的每个commit生成一个patch文件。
  注意，这样生成的patch文件只适用于Git。
}
\end{frame}
\begin{frame}{apply patch file}
  \gitcmd{\small\ttfamily
    \begin{tabular}{rl}
      git apply & [--stat | --summary |\\
                & \ --check | --reverse]\\
                & filename.[diff | patch]\\
    \end{tabular}
  }
{\ttfamily
  \begin{tabular}{rcl}
    --stat&:&只输出统计信息而不应用补丁内容\\
    --summary&:&显示补丁摘要\\
    --check&:&检查是否能成功的应用该补丁的内容\\
    --reverse&:&将应用过的补丁内容撤销\\
  \end{tabular}
}
\end{frame}

\section[use branch]{use branch}
\begin{frame}{use branch}
\end{frame}

\section[show branch topology]{show branch topology}
\begin{frame}{show branch topology}
  \gitcmd{git show-branch}
\end{frame}

\begin{frame}{show branch topology cont.}
\begin{figure}
  \centering
  \includegraphics[width=0.8\textwidth]{showbranch.png}%\\
  %\caption{show branch}\label{fig:showbranch}
\end{figure}
\end{frame}

\section[git GUI]{git GUI}
\begin{frame}{Git GUI}
\gitcmd{git gui}
\end{frame}

\begin{frame}{Git GUI cont.}
\begin{figure}
  \centering
  \includegraphics[width=0.8\textwidth]{gitk.png}%\\
  %\caption{GUI Window}\label{fig:gitk}
\end{figure}
\end{frame}

\section[external diff and merge tools]{external diff and merge tools}
\begin{frame}{external diff tool}
\begin{figure}
  \centering
  \includegraphics[width=0.8\textwidth]{diff.png}%\\
  %\caption{external diff tool}\label{fig:diff}
\end{figure}
\end{frame}

\begin{frame}{external merge tool}
\begin{figure}
  \centering
  \includegraphics[width=0.8\textwidth]{diff.png}%\\
  %\caption{external diff tool}\label{fig:diff}
\end{figure}
\end{frame}

\section[git log]{git log}
\begin{frame}{}
\end{frame}

\section[git push configuration]{git push configuration}
\begin{frame}{}
\end{frame}

\section[show index file]{show index file}
\begin{frame}{show index file}
  \gitcmd{git ls-files --stage}
\end{frame}

\begin{frame}{show index file cont.}
\begin{figure}
  \centering
  % Requires \usepackage{graphicx}
  \includegraphics[width=0.8\textwidth]{showindex.png}%\\
  %\caption{show index content}\label{fig:showindex}
\end{figure}
\end{frame}

\section[git add]{git add}
\begin{frame}{}
\end{frame}

\section[online repository]{online repository}
\begin{frame}{}
\end{frame}

\section[git in ZTE]{git in ZTE}
\begin{frame}{}
\end{frame}

\end{document}
